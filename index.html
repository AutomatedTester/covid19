<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="javascript/covid19.js"></script>
<script src="javascript/layout.js"></script>
<link rel="stylesheet" href="css/covid19.css">
<div id=lastUpdated></div>
<script>

    let lastDate;

    update().then(d => {
        let height = 600;
        let width = 1000;
        let margin = ({ top: 20, right: 20, bottom: 30, left: 30 });

        let data = d.data;
        let dates = data.map(obj => {
            return obj.date;
        });

        lastDate = dates[0];
        document.getElementById("lastUpdated").innerText = `Last updated: ${lastDate}`;

        let deaths = data.map(obj => {
            return obj.deathsDaily;
        });

        let casesBySpecimenDate = data.map(obj => {
            return obj.casesBySpecimenDate;
        });

        let casesDaily = data.map(obj => {
            return obj.casesDaily;
        })

        let hospitalCases = data.map(obj => {
            return obj.hospitalCases;
        });

        let covidOccupiedMVBeds = data.map(obj => {
            return obj.covidOccupiedMVBeds;
        });

        let layout = {
            title: 'England Covid Data',
        };

        let config = {
            responsive: true,
            scrollZoom: true,
        }

        let plot = [
            { x: dates, y: deaths, type: 'scatter', mode: "lines", name: "Deaths", fill: 'tozeroy' },
            { x: dates, y: casesBySpecimenDate, type: "scatter", mode: "lines", name: "Cases by Specimen date", fill: 'tozeroy' },
            { x: dates, y: casesDaily, type: "scatter", mode: "lines", name: "Cases Reported Daily", fill: "tozeroy" },
            { x: dates, y: hospitalCases, type: "scatter", mode: "lines", name: "Hospital Cases", fill: 'tozeroy' },
            { x: dates, y: covidOccupiedMVBeds, type: "scatter", mode: "lines", name: "Occupied ITU Bed", fill: 'tozeroy' }
        ];

        Plotly.newPlot('myDiv', plot, layout, config);

        let table = document.querySelector("table");
        let keys = Object.keys(data[0]);
        generateTableHead(table, keys);
        generateTable(table, data.slice(0, 7));
    });
</script>

<div id=myDiv></div>

<table></table>
